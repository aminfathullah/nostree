---
/**
 * ThemeInjector Component
 * Injects dynamic CSS variables based on user's theme configuration
 * This runs server-side to ensure proper theming on first render
 */

import type { Theme } from "../../schemas/nostr";

interface Props {
  theme?: Theme;
}

const { theme } = Astro.props;

// Default theme values
const defaultTheme = {
  mode: "dark" as const,
  colors: {
    background: "#09090b",
    foreground: "#f4f4f5",
    primary: "#8b5cf6",
    radius: "0.5rem",
  },
  font: "Inter" as const,
};

// Merge with user theme
const mergedTheme = theme || defaultTheme;

// Generate CSS custom properties
const cssVars = `
  :root {
    --theme-background: ${mergedTheme.colors.background};
    --theme-foreground: ${mergedTheme.colors.foreground};
    --theme-primary: ${mergedTheme.colors.primary};
    --theme-radius: ${mergedTheme.colors.radius};
    --theme-font: '${mergedTheme.font}', system-ui, sans-serif;
  }
`;

// Check if background is an image URL
const isImageBackground = mergedTheme.colors.background.startsWith("url(");
const backgroundStyle = isImageBackground
  ? `background-image: ${mergedTheme.colors.background}; background-size: cover; background-position: center; background-attachment: fixed;`
  : `background-color: ${mergedTheme.colors.background};`;
---

<style set:html={cssVars}></style>

<style is:global define:vars={{
  "profile-bg": mergedTheme.colors.background,
  "profile-fg": mergedTheme.colors.foreground,
  "profile-primary": mergedTheme.colors.primary,
  "profile-radius": mergedTheme.colors.radius,
}}>
  .profile-theme {
    color: var(--profile-fg);
  }
  
  .profile-theme .link-card {
    background-color: color-mix(in srgb, var(--profile-fg) 5%, transparent);
    border-radius: var(--profile-radius);
    border: 1px solid color-mix(in srgb, var(--profile-fg) 10%, transparent);
  }
  
  .profile-theme .link-card:hover {
    background-color: color-mix(in srgb, var(--profile-fg) 10%, transparent);
    border-color: color-mix(in srgb, var(--profile-fg) 20%, transparent);
  }
  
  .profile-theme .btn-primary {
    background-color: var(--profile-primary);
    color: white;
    border-radius: var(--profile-radius);
  }
</style>
